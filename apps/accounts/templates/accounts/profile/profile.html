{% extends 'base.html' %}
{% load static %}
{% block title %}Thông tin cá nhân - QHUN22 Mobile{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile/profile.css' %}">
{% endblock %}

{% block content %}
<div class="profile-container max-w-6xl mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Tài khoản của tôi</h1>
        <p class="text-gray-600 mt-1">Quản lý thông tin cá nhân của bạn</p>
    </div>
    
    <!-- Main Content Grid -->
    <div class="profile-grid flex flex-col lg:flex-row gap-8">
        <!-- Left Column: Sidebar -->
        <div class="profile-sidebar w-full lg:w-64 flex-shrink-0">
            {% include 'accounts/profile/sidebar.html' %}
        </div>
        
        <!-- Right Column: Main Content -->
        <div class="profile-content flex-1">
            <!-- Thông tin cá nhân Section -->
            <div class="profile-section bg-white rounded-2xl shadow-lg p-6 lg:p-8">
                <div class="section-header mb-6">
                    <h2 class="text-xl font-bold text-gray-800">Thông tin cá nhân</h2>
                    <p class="text-gray-500 text-sm mt-1">Thông tin tài khoản của bạn</p>
                </div>
                
                <!-- User Info Display (Read-only) -->
                <div class="user-info-grid grid gap-4 mb-8" id="section-info">
                    <div class="info-item">
                        <label class="block text-sm font-medium text-gray-500 mb-1">Họ và tên</label>
                        <div class="info-value text-gray-800 font-medium">
                            {% if user.get_full_name %}
                                {{ user.get_full_name }}
                            {% else %}
                                <span class="text-gray-400">Chưa cập nhật</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <label class="block text-sm font-medium text-gray-500 mb-1">Email</label>
                        <div class="info-value text-gray-800 font-medium">{{ user.email }}</div>
                    </div>
                    
                    <div class="info-item">
                        <label class="block text-sm font-medium text-gray-500 mb-1">Số điện thoại</label>
                        <div class="info-value text-gray-800 font-medium">
                            {% if user.phone_number %}
                                {{ user.phone_number }}
                            {% else %}
                                <span class="text-gray-400">Chưa cập nhật</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Password Change Form -->
                <div class="password-change-section border-t pt-6 mt-6" id="section-password">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Đổi mật khẩu</h3>
                    
                    <form method="POST" class="password-form max-w-md" id="changePasswordForm">
                        {% csrf_token %}
                        
                        <div class="form-group mb-4">
                            <label for="new_password" class="block text-gray-700 font-medium mb-2">
                                Mật khẩu mới <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input type="password" 
                                       id="new_password" 
                                       name="new_password" 
                                       placeholder="Nhập mật khẩu mới (ít nhất 6 ký tự)"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-12"
                                       required>
                                <button type="button" 
                                        onclick="togglePassword('new_password')"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1">
                                    <i class="fas fa-eye" id="new_passwordIcon"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group mb-4">
                            <label for="confirm_password" class="block text-gray-700 font-medium mb-2">
                                Nhập lại mật khẩu <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input type="password" 
                                       id="confirm_password" 
                                       name="confirm_password" 
                                       placeholder="Nhập lại mật khẩu mới"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-12"
                                       required>
                                <button type="button" 
                                        onclick="togglePassword('confirm_password')"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1">
                                    <i class="fas fa-eye" id="confirm_passwordIcon"></i>
                                </button>
                            </div>
                        </div>
                        
                        <button type="submit" 
                                name="change_password"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg">
                            Cập nhật mật khẩu
                        </button>
                    </form>
                </div>
                
                <!-- Trang quản trị (chỉ hiện cho admin) -->
                {% if user.is_staff or user.is_superuser %}
                <div class="admin-section border-t pt-6 mt-6" id="section-admin">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Quản trị</h3>
                    <a href="/admin/dashboard/" 
                       class="inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                        </svg>
                        Trang quản trị
                    </a>
                </div>
                {% endif %}
                
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/profile/profile.js' %}" defer></script>
{% endblock %}

